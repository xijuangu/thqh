<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thqh.enterprise_wechat_backend.mapper.WechatUserMapper">

    <!-- 结果映射 -->
    <resultMap id="WechatUserResultMap" type="com.thqh.enterprise_wechat_backend.entity.WechatUser">
        <id property="id" column="id"/>
        <result property="userid" column="userid"/>
        <result property="name" column="name"/>
        <result property="status" column="status"/>
        <result property="sessionArchiveFlag" column="session_archive_flag"/>
        <result property="createdBy" column="created_by"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedBy" column="updated_by"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>


    <select id="getAllWechatUsers"  resultMap="WechatUserResultMap">
        SELECT * FROM wechat_user
    </select>


    <select id="getWechatUsersByStatus" parameterType="int" resultMap="WechatUserResultMap">
        SELECT * FROM wechat_user
        WHERE status = #{status}
    </select>





    <!-- 批量插入微信用户 -->
    <insert id="batchInsertWechatUsers" parameterType="java.util.List">
        INSERT INTO wechat_user
        (userid, name,status,session_archive_flag, created_at, updated_at)
        VALUES
        <foreach collection="list" item="user" separator=",">
            (#{user.userid}, #{user.name}, #{user.status}, #{user.sessionArchiveFlag},NOW(), NOW())
        </foreach>
    </insert>


    <update id="batchUpdateWechatUsers" parameterType="java.util.List">
        UPDATE wechat_user
        <set>
            name = CASE userid
            <foreach collection="list" item="user">
                WHEN #{user.userid} THEN #{user.name}
            </foreach>
            END,

            status = CASE userid
            <foreach collection="list" item="user">
                WHEN #{user.userid} THEN #{user.status}
            </foreach>
            END,

            session_archive_flag = CASE userid
            <foreach collection="list" item="user">
                WHEN #{user.userid} THEN #{user.sessionArchiveFlag}
            </foreach>
            END,

            updated_at = NOW()
        </set>
        WHERE userid IN
        <foreach collection="list" item="user" open="(" separator="," close=")">
            #{user.userid}
        </foreach>
    </update>


    <select id="getEmployeesByPage" resultMap="WechatUserResultMap">
        SELECT id, userid, name, status, session_archive_flag
        FROM wechat_user
        <where>
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
        </where>
    </select>

<!--    WechatUser selectByUserId(String fromUserId);-->
    <select id="selectByUserId" parameterType="String" resultMap="WechatUserResultMap">
            SELECT * FROM wechat_user WHERE userid = #{fromUserId}
    </select>


</mapper>